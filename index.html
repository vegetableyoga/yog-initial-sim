<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Add Initials Simulator | YOG MAT</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    
    <link rel="icon" href="icon.png" type="image/png">
    <link rel="apple-touch-icon" href="icon.png">

    <style>
        :root { 
            --mat-b: #1a1a1a; 
            --w: min(400px, 85vw); 
            /* ズーム感を出すため高さを幅の55%に。これでさらに入力欄が競り上がる */
            --h: calc(var(--w) * 0.55); 
        }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; background: #fff; color: #333; overflow-x: hidden; }
        
        .master-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 500px; }

        h1 { font-weight: 200; letter-spacing: 5px; margin: 20px 0 15px; font-size: 1.3rem; text-align: center; }

        /* FULL VIEW：1:4比率（50x200cm）を維持 */
        .mini { display: flex; flex-direction: column; align-items: center; margin-bottom: 20px; font-size: 10px; color: #aaa; font-weight: bold; width: 100%; }
        .thumb-container { position: relative; display: flex; justify-content: center; align-items: center; width: 160px; }
        .thumb { 
            width: 40px; 
            height: 160px; 
            background: var(--mat-b); 
            position: relative; 
            border: 1px solid #eee; 
        }
        .label-200 { position: absolute; right: calc(50% + 30px); white-space: nowrap; }
        .label-50 { margin-top: 8px; }
        
        /* インジケーター：下部30cm分（30/200 = 15%）を表示 */
        .indicator { position: absolute; bottom: 0; width: 100%; height: 15%; border: 2px solid #ff4444; box-sizing: border-box; }

        .mat-area { display: flex; flex-direction: column; align-items: center; width: 100%; }
        
        #mat { width: var(--w); height: var(--h); perspective: 2000px; cursor: pointer; }
        #card { width: 100%; height: 100%; position: relative; transition: 0.8s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        #mat.flipped #card { transform: rotateX(180deg); }

        .face { position: absolute; width: 100%; height: 100%; background: var(--mat-b); backface-visibility: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .face.back { transform: rotateX(180deg); }

        /* 配置：33.6mm / 300mm = 11.2% | 32mm / 300mm = 10.6% */
        .initials { position: absolute; left: 5.6%; bottom: 11.2%; font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: calc(var(--w) * 0.08); line-height: 1; color: #fff; transition: color 0.3s; z-index: 10; }
        .logo-box { position: absolute; right: 5.6%; bottom: 10.6%; display: flex; align-items: flex-end; }
        .logo-bro { width: calc(var(--w) * 0.0722); }
        .logo-yog { width: calc(var(--w) * 0.14); }
        img { width: 100%; height: auto; display: block; pointer-events: none; }
        .black-inv { filter: invert(1); }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-2px); } 75% { transform: translateX(2px); } }
        .shaking { animation: shake 0.1s ease-in-out infinite; }

        .hint { margin-top: 8px; font-size: 13px; font-weight: bold; color: #999; letter-spacing: 1px; }

        /* コントロール：ここを画面内に見切れさせる */
        .controls { width: 100%; padding: 15px 0; }
        label { display: block; font-size: 10px; font-weight: bold; margin-bottom: 5px; color: #aaa; letter-spacing: 2px; }
        
        input { 
            width: 100%; padding: 12px; font-size: 24px; font-family: 'Montserrat'; border: 2px solid #eee; 
            text-align: center; border-radius: 4px; margin-bottom: 15px; outline: none; text-transform: uppercase;
            box-sizing: border-box;
        }
        input.error { border-color: #ff4444; background-color: #fffafa; }

        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .dot-item { text-align: center; cursor: pointer; }
        .dot { width: 100%; aspect-ratio: 1; border-radius: 50%; border: 1px solid transparent; transition: 0.2s; }
        .dot-item.active .dot { border-color: #000; transform: scale(1.1); }
        .name { font-size: 8px; margin-top: 6px; color: #ccc; }

        footer { margin-top: 20px; padding-bottom: 30px; font-size: 12px; color: #bbb; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="master-wrapper">
        <h1>ADD INITIALS Simulator</h1>

        <div class="mini">
            <div class="thumb-container">
                <span class="label-200">200cm</span>
                <div class="thumb"><div class="indicator"></div></div>
            </div>
            <span class="label-50">50cm</span>
        </div>

        <div class="mat-area">
            <div id="mat" onclick="this.classList.toggle('flipped')">
                <div id="card">
                    <div class="face front">
                        <div class="initials" id="txt-front">VEG</div>
                        <div class="logo-box logo-bro"><img src="bro_logo_white.png" id="img-bro" alt="bro"></div>
                    </div>
                    <div class="face back">
                        <div class="initials" id="txt-back">VEG</div>
                        <div class="logo-box logo-yog"><img src="yog_logo_white.png" id="img-yog" alt="yog"></div>
                    </div>
                </div>
            </div>
            <div class="hint">Click mat to flip!!</div>
        </div>

        <div class="controls">
            <label>3-LETTER INITIALS (A-Z ONLY)</label>
            <input type="text" id="initial-input" maxlength="3" value="VEG" spellcheck="false" autocomplete="off" inputmode="latin">
            <label>COLOR PALETTE</label>
            <div id="palette" class="grid"></div>
        </div>

        <footer>© YOG Inc.</footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const colors = [
                { n: 'White', h: '#FFFFFF', l: 'w' }, { n: 'Lemon Yellow', h: '#FFF100', l: 'w' },
                { n: 'Orange', h: '#F39800', l: 'w' }, { n: 'Red', h: '#E60012', l: 'w' },
                { n: 'Rose Pink', h: '#E95295', l: 'w' }, { n: 'Purple', h: '#601986', l: 'w' },
                { n: 'Light Blue', h: '#00A0E9', l: 'w' }, { n: 'Classic Blue', h: '#00479D', l: 'w' },
                { n: 'Green', h: '#009944', l: 'w' }, { n: 'Gold Metallic', h: '#C5A059', l: 'b' },
                { n: 'Silver Metallic', h: '#A6A6A6', l: 'b' }, { n: 'Black', h: '#111111', l: 'b' }
            ];

            const palette = document.getElementById('palette');
            const input = document.getElementById('initial-input');
            const tf = document.getElementById('txt-front');
            const tb = document.getElementById('txt-back');
            const imgBro = document.getElementById('img-bro');
            const imgYog = document.getElementById('img-yog');
            let isComposing = false;
            let isUpdating = false; // 無限ループ防止フラグ

            function updateColor(colorObj) {
                tf.style.color = colorObj.h;
                tb.style.color = colorObj.h;
                const isBlackLogo = (colorObj.l === 'b');
                if (imgBro) imgBro.classList.toggle('black-inv', isBlackLogo);
                if (imgYog) imgYog.classList.toggle('black-inv', isBlackLogo);
            }

            function updateDisplay() {
                if (isComposing || isUpdating) return;

                let rawVal = input.value;
                // アルファベット以外を排除
                let cleanVal = rawVal.replace(/[^a-zA-Z]/g, '').toUpperCase().slice(0, 3);

                // エラーチェック（数字や記号、全角が含まれている場合）
                if (/[^a-zA-Z]/.test(rawVal) && rawVal !== '') {
                    input.classList.add('error');
                    tf.textContent = ""; tb.textContent = "";
                } else {
                    input.classList.remove('error');
                    
                    isUpdating = true; // 書き換え開始
                    input.value = cleanVal;
                    isUpdating = false; // 書き換え終了

                    tf.textContent = cleanVal;
                    tb.textContent = cleanVal;

                    if (cleanVal.length > 0 && cleanVal.length < 3) {
                        tf.classList.add('shaking'); tb.classList.add('shaking');
                    } else {
                        tf.classList.remove('shaking'); tb.classList.remove('shaking');
                    }
                }
            }

            colors.forEach((c, i) => {
                const el = document.createElement('div');
                el.className = 'dot-item' + (i === 0 ? ' active' : '');
                el.innerHTML = `<div class="dot" style="background:${c.h}; border-color:${c.h==='#FFFFFF'?'#ddd':'transparent'}"></div><div class="name">${c.n}</div>`;
                el.onclick = function() {
                    document.querySelectorAll('.dot-item').forEach(d => d.classList.remove('active'));
                    el.classList.add('active');
                    updateColor(c);
                };
                palette.appendChild(el);
            });

            input.addEventListener('compositionstart', () => { isComposing = true; });
            input.addEventListener('compositionend', () => { 
                isComposing = false; 
                updateDisplay(); 
            });
            input.addEventListener('input', updateDisplay);

            updateColor(colors[0]);
            updateDisplay();
        });
    </script>
</body>
</html>
